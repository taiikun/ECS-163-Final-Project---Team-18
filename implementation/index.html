<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Industry Interactive Visualizations (2020-2024)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Story Navigation Dots -->
    <div id="storyNav" class="story-nav"></div>

    <!-- NARRATIVE SECTION (Martini Glass Stem) -->

    <!-- Step 1: Title/Hook -->
    <section class="narrative-section bg-gradient-1">
        <div class="story-step active" data-step="0">
            <div class="story-content">
                <div class="story-text" style="grid-column: span 2; text-align: center;">
                    <h1>The Great Tech Shift: 2020–2024</h1>
                    <p>The tech industry underwent one of its most dramatic transformations in recent memory.</p>
                    <p>This dashboard reveals how tech careers transformed—and where they're headed next.</p>
                </div>
            </div>
            <div class="scroll-prompt">
                Scroll to uncover the trends that are shaping tech careers
            </div>
        </div>
    </section>

    <!-- Step 2: Stream Graph -->
    <section class="narrative-section bg-gradient-2">
        <div class="story-step" data-step="1">
            <div class="story-content">
                <div class="story-text">
                    <h2>What’s changed in tech over the last 4 years?</h2>
                    <p>Tech salaries have steadily climbed from 2020 to 2024, with many roles seeing significant growth as the industry surged — but rising pay and expansion came with a cost. Not all roles or companies could keep up, leading to widespread layoffs across sectors.</p>             
                </div>
                <div class="story-chart-container">
                    <div class="story-chart-title">Tech Salary Trends by Role</div>
                    <div id="story-stream-chart" style="width: 100%; height: 400px;"></div>
                    <div id="story-stream-legend" class="story-legend"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Step 3: Map Visualization -->
    <section class="narrative-section bg-gradient-3">
        <div class="story-step" data-step="2">
            <div class="story-content">
                <div class="story-text">
                    <h2>Where did the layoffs hit hardest?</h2>
                    <p>Take a look at the map — the Bay Area, home to Silicon Valley giants, was hit especially hard, with over 150,000 layoffs centered around San Francisco and San Jose.</p>
                    <p>Follow that trail to New York City, where nearly 81,000 tech jobs were cut, and then up to Seattle, with more than 53,000.</p>

                </div>
                <div class="story-chart-container">
                    <div class="story-chart-title">Tech Layoffs by Location</div>
                    <svg id="story-map-chart" width="600" height="400"></svg>
                </div>
            </div>
        </div>
    </section>

    <!-- Step 4: Bar Chart -->
    <section class="narrative-section bg-gradient-4">
        <div class="story-step" data-step="3">
            <div class="story-content">
                <div class="story-text">
                    <h2>Who led the wave of layoffs?</h2>
                    <p>Between 2020 and 2024, a few tech giants stood out — not for growth, but for the sheer scale of their cuts.</p>
                    <p>Amazon alone let go of over 55,000 employees, followed by Meta with 42,000. Microsoft, Google, and others weren’t far behind.</p>
                    <p>This chart highlights the top companies driving the layoff numbers, giving us a clear picture of where the industry tightened its belt the most.</p>
                </div>
                <div class="story-chart-container">
                    <svg id="story-bar-chart" width="600" height="400"></svg>
                </div>
            </div>
        </div>
    </section>

    <!-- Step 5: Line Chart -->
    <section class="narrative-section bg-gradient-5">
        <div class="story-step" data-step="4">
            <div class="story-content">
                <div class="story-text">
                    <h2>Recovery Trajectory</h2>
                    <p>Notice the sharp rise in tech job openings through 2022, followed by a large decline.</p>
                    <p>This trend reflects the post-pandemic hiring boom as companies raced to scale up—only to face market corrections and economic uncertainty in the years after.</p>
                </div>
                <div class="story-chart-container">
                    <div class="story-chart-title">Job Market Recovery</div>
                    <svg id="StoryLineChartJOLTS" width="600" height="400" data-rendered="false"></svg>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Step 6: Donut Chart -->
    <section class="narrative-section bg-gradient-6">
        <div class="story-step" data-step="5">
            <div class="story-content">
                <div class="story-text">
                    <h2>Work Style Distribution</h2>
                    <p>By 2023, onsite work is still the dominant work style in tech, with remote roles still making up a visible share.</p>    
                </div>
                <div class="story-chart-container">
                    <div class="story-chart-title">Remote vs Hybrid vs Onsite Work</div>
                    <div id="story-donut-chart" style="width: 100%; height: 400px;"></div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- INTERACTIVE SECTION -->
    <section class="interactive-section">
        <div class="interactive-header">
            <h2>Explore The Data</h2>
            <p>Now it's your turn to explore. Dive deep into salary trends, geographical patterns, and company data. Use
                these interactive visualizations to inform your career decisions.</p>
        </div>

        <!-- Main Interactive Stream Graph -->
        <div class="viz-card">
            <div class="viz-header">
                <h3>Tech Salary Evolution</h3>
                <p>Explore how salaries for different tech roles have evolved over time.</p>
            </div>
            <div class="viz-content">
                <div class="controls-container">
                    <div class="controls">
                        <div class="control-group">
                            <label for="aggregation-select">Time Period:</label>
                            <select id="aggregation-select">
                                <option value="quarterly">Quarterly</option> 
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label> </label>
                            <button id="animate-btn" title="Click to animate the visualization">Animate Timeline</button>
                        </div>
                    </div>
                </div>
                <div id="chart-container">
                    <div class="loading">Loading interactive visualization...</div>
                </div>
                <div id="legend" class="legend"></div>
            </div>
        </div>

        <!-- Secondary Visualizations Grid -->
        <div class="visualization-grid">
            <div class="viz-card">
                <div class="viz-header">
                    <h3>Company Layoff Analysis</h3>
                    <p>See which companies had the most layoffs by year—essential intel for evaluating job stability.</p>
                </div>
                <div class="viz-content">
                    <div id="yearSelectLayoffsByCompany" style="display: none;">
                        <select></select>
                    </div>
                    <div id="yearButtonsLayoffsByCompany"></div>
                    <svg id="barChartLayoffsByCompany" width="800" height="400"></svg>
                </div>
            </div>

            <div class="viz-card">
                <div class="viz-header">
                    <h3>Geographic Impact Analysis</h3>
                    <p>Discover which locations were hit hardest and which remained stable.</p>
                </div>
                <div class="viz-content">
                    <div id="yearButtonsLayoffsByLocation"></div>
                    <svg id="barChartLayoffsByLocation" width="800" height="400"></svg>
                </div>
            </div>

            <div class="viz-card">
                <div class="viz-header">
                    <h3>Job Market Recovery Tracker</h3>
                    <p>Track the recovery of tech job openings month by month.</p>
                </div>
                <div class="viz-content">
                    <svg id="InteractiveLineChartJOLTS" width="800" height="400"></svg>
                </div>
            </div>

            <div class="viz-card">
                <div class="viz-header">
                    <h3>Remote vs Hybrid vs Onsite (2023)</h3>
                    <p>Distribution of job types in the tech industry.</p>
                </div>
                <div class="viz-content">
                    <div id="donutChartRemote" style="width: 100%; height: 400px;"></div>
                </div>
            </div>

            <div class="viz-card map-card">
                <div class="viz-header">
                    <h3>Geographic Layoff Distribution</h3>
                    <p>Interactive map showing tech layoffs across the United States.</p>
                </div>
                <div class="viz-content">
                    <svg id="interactiveMap" width="800" height="500"></svg>
                </div>
            </div>
        </div>
    </section>

    <div class="tooltip" id="tooltip"></div>

    <!-- Scripts -->
    <script src="scripts/stream-graph.js"></script>
    <script src="scripts/bar-chart-layoffs-by-company.js"></script>
    <script src="scripts/bar-chart-layoffs-by-location.js"></script>
    <script src="scripts/line-chart-job-postings.js"></script>
    <script src="scripts/donut-chart-remote-vs-onsite.js"></script>
    <script src="scripts/interactive-stream-graph.js"></script>
    <script src="scripts/story-map.js"></script>
    <script src="scripts/story-bar-chart.js"></script>

    <script>
        // Function to create story visualizations
        async function loadStoryChart(stepIndex) {
            switch(stepIndex) {
                case 1:
                    await createStoryStreamGraph();
                    break;
                case 2:
                    await createStoryMap();
                    break;
                case 3:
                    await createStoryBarChart();
                    break;
                case 4:
                    if (!document.querySelector("#StoryLineChartJOLTS").dataset.rendered) {
                        init_line_chart_jolts_information('story');
                        document.querySelector("#StoryLineChartJOLTS").dataset.rendered = "true";
                    }
                    break;
                case 5:
                    if (!document.querySelector("#story-donut-chart").dataset.rendered) {
                        init_donut_chart_remote_vs_onsite("#story-donut-chart");
                        document.querySelector("#story-donut-chart").dataset.rendered = "true";
                    }
                    break;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing interactive visualizations...');

            setTimeout(() => {
                if (typeof updateVisualization === 'function') updateVisualization();
                if (typeof init_bar_chart_layoffs_by_company === 'function') init_bar_chart_layoffs_by_company();
                if (typeof init_bar_chart_layoffs_by_location === 'function') init_bar_chart_layoffs_by_location();
                if (typeof init_line_chart_jolts_information === 'function') {
                    init_line_chart_jolts_information('interactive');
                    init_line_chart_jolts_information('story');
                }
                if (typeof init_donut_chart_remote_vs_onsite === 'function') init_donut_chart_remote_vs_onsite();
                initInteractiveMap();
            }, 500);

            window.addEventListener('error', (event) => {
                if (event.target.tagName === 'SCRIPT') {
                    console.error('Error loading script:', event.target.src, event);
                } else if (event.target.tagName === 'LINK') {
                    console.error('Error loading stylesheet:', event.target.href, event);
                } else {
                    console.error('Unhandled error:', event);
                }
            }, true);
        });

        let currentStep = 0;
        const totalSteps = 6; // Updated to 6 steps

        function initStoryNavigation() {
            const nav = document.getElementById('storyNav');
            for (let i = 0; i < totalSteps; i++) {
                const dot = document.createElement('div');
                dot.className = `nav-dot ${i === 0 ? 'active' : ''}`;
                dot.addEventListener('click', () => goToStep(i));
                nav.appendChild(dot);
            }
        }

        function handleScroll() {
            const sections = document.querySelectorAll('.narrative-section');
            const viewportMiddle = window.innerHeight / 2;

            sections.forEach((section, index) => {
                const rect = section.getBoundingClientRect();
                const step = section.querySelector('.story-step');
                const navDot = document.querySelectorAll('.nav-dot')[index];

                if (!step) return; // skip if step is missing

                if (rect.top < viewportMiddle && rect.bottom > viewportMiddle) {
                    if (currentStep !== index) {
                        currentStep = index;
                        updateActiveStep(index);
                        loadStoryChart(index);
                    }
                }
            });
        }

        function updateActiveStep(stepIndex) {
            document.querySelectorAll('.nav-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === stepIndex);
            });

            document.querySelectorAll('.story-step').forEach((step, i) => {
                step.classList.toggle('active', i === stepIndex);
            });
        }

        function goToStep(stepIndex) {
            const sections = document.querySelectorAll('.narrative-section');
            if (sections[stepIndex]) {
                sections[stepIndex].scrollIntoView({ behavior: 'smooth' });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initStoryNavigation();

            let scrollTimeout;
            window.addEventListener('scroll', () => {
                if (scrollTimeout) clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(handleScroll, 16);
            });

            handleScroll();
        });
    </script>
</body>

</html>
